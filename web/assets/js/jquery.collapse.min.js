/*
 * Collapse plugin for jQuery
 * --
 * source: http://github.com/danielstocks/jQuery-Collapse/
 * site: http://webcloud.se/jQuery-Collapse
 *
 * @author Daniel Stocks (http://webcloud.se)
 * Copyright 2013, Daniel Stocks
 * Released under the MIT, BSD, and GPL Licenses.
 */
(function(d){function f(a,c){c=c||{};var b=this,e=c.query||"\x3e :even";d.extend(b,{$el:a,options:c,sections:[],isAccordion:c.accordion||!1,db:c.persist?jQueryCollapseStorage(a.get(0).id):!1});b.states=b.db?b.db.read():[];b.$el.find(e).each(function(){new jQueryCollapseSection(d(this),b)});(function(a){b.$el.on("click","[data-collapse-summary] "+(a.options.clickQuery||""),d.proxy(b.handleClick,a));b.$el.bind("toggle close open",d.proxy(b.handleEvent,a))})(b)}function g(a,c){c.options.clickQuery||a.wrapInner('\x3ca href\x3d"#"/\x3e');d.extend(this,{isOpen:!1,$summary:a.attr("data-collapse-summary",""),$details:a.next(),options:c.options,parent:c});c.sections.push(this);var b=c.states[this._index()];0===b?this.close(!0):this.$summary.is(".open")||1===b?this.open(!0):this.close(!0)}f.prototype={handleClick:function(a,c){a.preventDefault();c=c||"toggle";for(var b=this.sections,e=b.length;e--;)if(d.contains(b[e].$summary[0],a.target)){b[e][c]();break}},handleEvent:function(a){if(a.target==this.$el.get(0))return this[a.type]();this.handleClick(a,a.type)},open:function(a){if(isFinite(a))return this.sections[a].open();d.each(this.sections,function(a,b){b.open()})},close:function(a){if(isFinite(a))return this.sections[a].close();d.each(this.sections,function(a,b){b.close()})},toggle:function(a){if(isFinite(a))return this.sections[a].toggle();d.each(this.sections,function(a,b){b.toggle()})}};g.prototype={toggle:function(){this.isOpen?this.close():this.open()},close:function(a){this._changeState("close",a)},open:function(a){this.options.accordion&&!a&&d.each(this.parent.sections,function(a,b){b.close()});this._changeState("open",a)},_index:function(){return d.inArray(this,this.parent.sections)},_changeState:function(a,c){this.isOpen="open"==a;if(d.isFunction(this.options[a])&&!c)this.options[a].apply(this.$details);else this.$details[this.isOpen?"show":"hide"]();this.$summary.toggleClass("open","close"!=a);this.$details.attr("aria-hidden","close"==a);this.$summary.attr("aria-expanded","open"==a);this.$summary.trigger("open"==a?"opened":"closed",this);this.parent.db&&this.parent.db.write(this._index(),this.isOpen)}};d.fn.extend({collapse:function(a,c){return(c?d("body").find("[data-collapse]"):d(this)).each(function(){var b=c?{}:a,e=d(this).attr("data-collapse")||"";d.each(e.split(" "),function(a,c){c&&(b[c]=!0)});new f(d(this),b)})}});d(function(){d.fn.collapse(!1,!0)});jQueryCollapse=f;jQueryCollapseSection=g})(window.jQuery);